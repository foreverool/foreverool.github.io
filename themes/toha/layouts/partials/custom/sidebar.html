<!-- 自定义侧边栏：用JSONP获取GoatCounter统计数据（绕过CORS） -->
<div class="card mt-3">
  <div class="card-header">
    <h5 class="mb-0">站点统计</h5>
  </div>
  <div class="card-body">
    <p class="text-muted mb-2">总访问量：<span id="total-visits">加载中...</span></p>
    <p class="text-muted">当前页面访问量：<span id="page-visits">加载中...</span></p>
  </div>
</div>

<script>
  // 替换为你的正确站点代码
  const goatCounterCode = "foreverool";
  const baseApiUrl = `https://${goatCounterCode}.goatcounter.com`;

  // 1. JSONP请求：获取总访问量（核心：绕过CORS限制）
  function getTotalVisitsCallback(data) {
    document.getElementById("total-visits").textContent = data.count.toLocaleString();
  }
  const totalScript = document.createElement("script");
  totalScript.src = `${baseApiUrl}/count.json?callback=getTotalVisitsCallback`;
  totalScript.onerror = () => {
    document.getElementById("total-visits").textContent = "获取失败";
  };
  document.body.appendChild(totalScript);

  // 2. JSONP请求：获取当前页面访问量
  function getPageVisitsCallback(data) {
    document.getElementById("page-visits").textContent = data.count.toLocaleString();
  }
  const currentPath = encodeURIComponent(window.location.pathname || "/");
  const pageScript = document.createElement("script");
  pageScript.src = `${baseApiUrl}/count.json?path=${currentPath}&callback=getPageVisitsCallback`;
  pageScript.onerror = () => {
    document.getElementById("page-visits").textContent = "获取失败";
  };
  document.body.appendChild(pageScript);
</script>